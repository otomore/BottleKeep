# BottleKeep プロジェクト要件定義書

## 1. プロジェクト概要

### 1.1 プロジェクト名
BottleKeep - iOS/iPadOS ウイスキーコレクション管理アプリ

### 1.2 プロジェクトの目的
個人のウイスキーコレクションを効率的に管理し、購入・飲酒・評価履歴を記録することで、自分のコレクションを把握し楽しむためのiOS/iPadOSネイティブアプリを作成する。

### 1.3 プロジェクト性質
- **タイプ**: iOS個人アプリ（趣味開発）
- **主要ユーザー**: 開発者本人
- **対象デバイス**: iPhone、iPad
- **配布方法**: 個人利用（将来的にApp Store検討）
- **スケール**: 小規模・オフライン完結

## 2. 機能要件

### 2.1 コア機能

#### 2.1.1 ボトル管理機能
- **ボトル登録**: 基本情報（銘柄、蒸留所、年代、度数、容量）
- **写真管理**: 複数画像の登録・表示
- **購入情報**: 購入日、購入価格、購入店舗
- **飲酒記録**: 開栓日、飲酒履歴、残量管理
- **評価・レビュー**: 5段階評価、テイスティングノート

#### 2.1.2 検索・フィルタリング機能
- **基本検索**: 銘柄名、蒸留所名での検索
- **詳細フィルタ**: 地域、タイプ、価格帯、評価
- **ソート機能**: 価格、購入日、評価、アルファベット順

#### 2.1.3 統計・分析機能
- **コレクション統計**: 総本数、総価値、平均価格
- **地域別分析**: スコットランド、日本、アメリカ等の分布
- **個人統計**: 購入履歴、飲酒ペース、評価傾向
- **飲酒統計**: 月別消費量、お気に入り分析

### 2.2 付加機能

#### 2.2.1 ウィッシュリスト機能
- 購入予定ボトルの管理
- メモ・優先度設定
- 予算管理

#### 2.2.2 バックアップ・同期機能
- データのクラウドバックアップ
- 複数デバイス間での同期

## 3. 非機能要件

### 3.1 パフォーマンス要件
- **起動時間**: 2秒以内
- **データ読み込み**: 1000件のボトルで3秒以内
- **画像表示**: サムネイル1秒以内、フル画像3秒以内
- **検索応答**: 0.5秒以内

### 3.2 信頼性要件
- **可用性**: オフライン利用可能
- **データ整合性**: データ損失ゼロ
- **クラッシュ率**: 1%以下

### 3.3 互換性要件
- **iOS**: 16.0以上
- **デバイス**: iPhone SE(第3世代)以降、iPad(第8世代)以降
- **iCloud**: CloudKit対応

#### 2.2.3 エクスポート機能
- PDF形式でのコレクションリスト出力
- CSV形式でのデータエクスポート

## 3. 非機能要件

### 3.1 UI/UX要件
- **デザイン言語**: iOS Human Interface Guidelines準拠
- **ナビゲーション**: TabView + NavigationView構成
- **アダプティブUI**: iPhone/iPadの画面サイズ対応
- **アクセシビリティ**: VoiceOver基本対応、Dynamic Type対応
- **インタラクション**: スワイプアクション、ロングプレスメニュー

### 3.2 性能要件
- **レスポンス時間**: 基本操作は1秒以内（ローカル処理）
- **データ容量**: 1GB（画像含む、iCloudストレージ利用）
- **画像処理**: リアルタイム圧縮・リサイズ
- **同期速度**: iCloud同期は自動・バックグラウンド

### 3.3 セキュリティ要件
- **デバイス認証**: Face ID / Touch ID / パスコード
- **データ暗号化**: iOS標準暗号化（デバイス・iCloud間）
- **プライバシー**: デバイス内完結・外部送信なし
- **写真アクセス**: カメラ・フォトライブラリへの適切な権限管理

### 3.4 可用性要件
- **オフライン動作**: ネットワーク不要で完全動作
- **バックアップ**: iCloud自動同期
- **復旧**: 新端末でのiCloud復元
- **データ保持**: デバイス削除まで永続化

### 3.5 互換性要件
- **iOS**: iOS 16.0以上
- **iPadOS**: iPadOS 16.0以上
- **デバイス**: iPhone (12以降)、iPad (第8世代以降) 推奨
- **画面対応**: iPhone、iPad、iPad Proの全サイズ
- **ダークモード**: 完全対応

## 4. 技術要件

### 4.1 iOS技術スタック
- **開発言語**: Swift 5.9+
- **UIフレームワーク**: SwiftUI
- **データ管理**: Core Data + CloudKit
- **画像処理**: UIKit + Core Image
- **カメラ機能**: AVFoundation
- **開発環境**: Xcode 15+

### 4.2 システム要件
- **開発**: Xcode on macOS
- **テスト**: iOS Simulator + 実機テスト
- **配布**: 個人用（Xcodeから直接インストール）
- **バージョン管理**: Git + GitHub
- **バックアップ**: iCloud Core Data同期

### 4.3 Core Dataモデル詳細設計

#### 4.3.1 Entity設計
**Bottle Entity**:
- **基本情報**:
  - id: UUID (Primary Key)
  - name: String (銀柄名)
  - distillery: String (蒸留所)
  - region: String (地域)
  - type: String (タイプ: Single Malt, Blend等)
  - abv: Double (アルコール度数)
  - volume: Int32 (容量: ml)
  - vintage: Int32? (年代, Optional)
- **購入情報**:
  - purchaseDate: Date
  - purchasePrice: Decimal?
  - shop: String?
- **飲酒情報**:
  - openedDate: Date?
  - remainingVolume: Int32 (残量: ml)
  - rating: Int16? (1-5段階)
  - notes: String?
- **メタデータ**:
  - createdAt: Date
  - updatedAt: Date
  - photos: NSSet (PhotoEntityへのOne-to-Many)

**PhotoEntity**:
- id: UUID
- bottleID: UUID (Bottleへの外部キー)
- fileName: String (ファイル名)
- isMain: Bool (メイン写真フラグ)
- createdAt: Date
- bottle: Bottle (Many-to-Oneリレーション)

**WishlistEntity**:
- id: UUID
- bottleName: String
- distillery: String?
- priority: Int16 (1-5)
- budget: Decimal?
- notes: String?
- targetPrice: Decimal?
- createdAt: Date
- updatedAt: Date

#### 4.3.2 画像管理戦略
- **保存方法**: Documentsディレクトリにファイル保存
- **ファイル名**: UUID.jpg形式
- **圧縮**: JPEG 80%品質
- **サイズ制限**: 最大2048x2048pxにリサイズ
- **CloudKit同期**: CKAssetでファイル同期

#### 4.3.3 CloudKit制約と対応
- **データ容量**: 1GB/ユーザー
- **ファイルサイズ**: 最大1MB/ファイル
- **同期方式**: NSPersistentCloudKitContainer使用
- **競合解決**: 最終更新優先（Last Write Wins）

## 5. 制約事項

### 5.1 技術的制約
- **予算制限**: 0円（Apple Developer Program除く）
- **開発期間**: 制約なし（趣味開発）
- **リソース**: 個人開発のみ
- **技術選択**: Swift/SwiftUI学習重視
- **配布制約**: 個人利用のみ（App Store配布は将来検討）

#### 5.1.1 iOS特有制約
- **CloudKit制約**: 1GB/ユーザー、ファイルサイズ1MB以下
- **Core Dataパフォーマンス**: 1000件以上でページング考慮
- **メモリ管理**: 大量画像読み込み時のメモリリーク防止
- **バックグラウンド処理**: アプリサスペンド時のCloudKit同期制限

### 5.2 法的制約
- **著作権**: 蒸留所・ブランドの商標権尊重
- **プライバシー**: iOS標準に準拠、データ外部送信なし
- **アルコール関連**: 責任ある利用の促進
- **App Store**: 将来的な配布時のガイドライン準拠

### 5.3 プロジェクト制約
- **マネタイズ**: 長期的な検討事項（優先度低）
- **データ利用**: 個人データの外部提供は行わない
- **スケール**: 無理な拡張は行わない

## 6. 成功指標

### 6.1 個人的成功指標
- **使いやすさ**: 自分が継続的に使えること
- **データ蓄積**: 100本以上のボトル情報を管理
- **機能充実**: 必要な機能が過不足なく実装されている

### 6.2 技術的成功指標
- **学習効果**: 新しい技術の習得
- **安定性**: 個人利用で問題ないレベル
- **メンテナンス性**: 一人でメンテナンスできること

## 7. リリース計画

### 7.1 MVP（最小実用製品） - 実装順序

#### フェーズ1A: データ層構築
1. **Core Dataモデル設計** - 最優先
2. **基本エンティティ実装** - 最優先
3. **ローカルデータ操作** - 最優先

#### フェーズ1B: 基本UI構築
4. **ボトル一覧画面（List）** - 高優先
5. **ボトル登録画面** - 高優先
6. **ボトル詳細画面** - 高優先

#### フェーズ1C: 機能完成
7. **写真撮影・保存** - 中優先
8. **基本検索機能** - 中優先
9. **CloudKit同期** - 低優先（最後に追加）

### 7.2 フェーズ2
- ウィッシュリスト機能
- 統計画面（グラフ表示）
- データエクスポート機能（CSV/PDF）
- ダークモード最適化

### 7.3 フェーズ3（将来的な検討）
- Apple Watch対応
- Shortcuts App連携
- ウィジェット機能
- App Store配布

---

## 8. 技術リスクと対策

### 8.1 主要リスク
- **CloudKit同期失敗**: ローカルデータ優先、手動リトライ機能
- **大量データ時のパフォーマンス**: ページング、遅延読み込み
- **メモリ不足**: 画像キャッシュ管理、サムネイル生成
- **iOSバージョン非互換**: 最低iOSバージョンの見直し

### 8.2 緩和策
- **オフラインファースト**: ネットワーク不要で基本機能利用可能
- **段階的実装**: MVPで基本機能確立後、最適化
- **シンプル設計**: 複雑な機能より安定性重視

---

## 9. ユーザビリティ要件

### 9.1 ユーザビリティ指標
- **学習性**: 新規ユーザーが主要機能を30分で習得可能
- **効率性**: 既存ユーザーがボトル登録を2分以内で完了
- **記憶性**: 1週間使用中断後も操作方法を思い出せる
- **エラー許容性**: 誤操作の取り消し・修正機能
- **満足度**: 継続使用意欲を維持

### 9.2 ユーザビリティテスト計画
```
テストケース1: ボトル登録フロー
- 対象: 初回利用者想定
- タスク: ウイスキーボトル1本の完全登録
- 成功基準: 5分以内、エラーなし

テストケース2: 検索・フィルタ操作
- 対象: 100本登録後の状況想定
- タスク: 特定条件でのボトル検索
- 成功基準: 30秒以内、直感的操作

テストケース3: データ同期確認
- 対象: 複数デバイス利用者想定
- タスク: iPhone→iPad間でのデータ同期確認
- 成功基準: 自動同期、データ整合性保持
```

### 9.3 アクセシビリティ要件
- **VoiceOver**: 全画面でスクリーンリーダー対応
- **Dynamic Type**: 文字サイズ変更対応（最大200%）
- **Color Contrast**: WCAG AA基準準拠（4.5:1）
- **Switch Control**: 外部スイッチでの操作対応
- **Voice Control**: 音声操作の基本対応

## 10. 国際化・ローカライゼーション要件

### 10.1 対応言語
- **第一言語**: 日本語（完全対応）
- **第二言語**: 英語（将来対応検討）
- **地域化**: 日本の酒類規制・文化に対応

### 10.2 ローカライゼーション詳細
```
対応項目:
- UI文字列: 100%日本語化
- 日付形式: 日本標準（yyyy/MM/dd）
- 数値形式: 日本標準（3桁区切り）
- 通貨: 日本円（¥）表示
- 単位系: メートル法（ml, %）
- 酒類分類: 日本の酒税法準拠
```

### 10.3 文化的配慮
- **責任ある飲酒**: 適正な利用促進メッセージ
- **法的制限**: 20歳未満飲酒禁止の注意喚起
- **社会的配慮**: 過度な飲酒を助長しない設計

---

**文書バージョン**: 3.1
**作成日**: 2025-09-21
**最終更新**: 2025-09-23
**作成者**: 個人プロジェクト